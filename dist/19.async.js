(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[19],{gtY9:function(e,t,a){"use strict";var r=a("mZ4U"),n=a("fbTi");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("Jkyn");var l=r(a("DwzN"));a("CuyC");var s=r(a("PdMq"));a("nCvR");var d=r(a("otiJ")),o=r(a("mK77")),i=r(a("43Yg")),u=r(a("/tCh")),f=r(a("Tfcp")),c=r(a("scpF")),m=r(a("O/V9")),p=r(a("8aBX"));a("DvNH");var h=r(a("SzGI"));a("pLlE");var Y=r(a("qQZ1"));a("5KzM");var _,v,g,y,D=r(a("FCwu")),w=n(a("ZZRV")),M=(a("EaaV"),r(a("a/LZ"))),E=a("LneV"),b=r(a("t3Un")),S=r(a("eKz+")),k=r(a("voBT")),z=a("+n12");function F(e){return function(){var t,a=(0,m.default)(e);if(R()){var r=(0,m.default)(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return(0,c.default)(this,t)}}function R(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var x=D.default.Item,C=Y.default.Option,N=(h.default.Search,h.default.TextArea,_=(0,E.connect)(function(e){var t=e.operation_logs,a=e.loading;return{operation_logs:t,loading:a.models.operation_logs}}),v=D.default.create(),_(g=v((y=function(e){(0,p.default)(a,e);var t=F(a);function a(e){var r;return(0,i.default)(this,a),r=t.call(this,e),r.resize=function(){r.setState({tableY:document.querySelector(".table-page").offsetHeight-153})},r.handleSearch=function(e,t){console.log("handleSearch",e);var a=(0,f.default)(r),n=r.props.dispatch;n({type:"operation_logs/fetch",payload:(0,o.default)({},e),callback:function(){console.log("handleSearch callback"),a.setState((0,o.default)({},e)),t&&t()}})},r.handleFormReset=function(){var e=r.props.form;e.resetFields(),r.handleSearch({page:1,username:"",per_page:30,started_at:(0,M.default)().format("YYYY-MM-DD"),ended_at:(0,M.default)().format("YYYY-MM-DD")})},r.permissions=JSON.parse(localStorage.getItem("permissions")),r.state={showAddBtn:(0,k.default)(r.permissions,{name:"user_add_and_edit"}),showdelBtn:(0,k.default)(r.permissions,{name:"user_delete"}),showPasswordBtn:(0,k.default)(r.permissions,{name:"user_default_password_edit"}),user_password_reset:(0,k.default)(r.permissions,{name:"user_password_reset"}),visible:!1,done:!1,page:1,per_page:30,username:"",editRecord:{},started_at:(0,M.default)().format("YYYY-MM-DD"),ended_at:(0,M.default)().format("YYYY-MM-DD"),users:[]},r}return(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;(0,b.default)("/users",{method:"GET",params:{return:"all"}}).then(function(t){200===t.status&&e.setState({users:t.data.data})}),this.setState({tableY:document.querySelector(".table-page").offsetHeight-153});var t=this.props.dispatch;t({type:"operation_logs/fetch",payload:{page:1,username:"",started_at:(0,M.default)().format("YYYY-MM-DD"),ended_at:(0,M.default)().format("YYYY-MM-DD")}}),window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),window.removeEventListener("resize",this.resize)}},{key:"renderSimpleForm",value:function(){var e=this,t=this.props.form.getFieldDecorator;return w.default.createElement(D.default,{layout:"inline",className:"search-form"},w.default.createElement(x,{label:"\u7528\u6237\u540d"},t("user_id",{initialValue:""})(w.default.createElement(Y.default,{style:{width:"120px"}},this.state.users.map(function(e,t){return w.default.createElement(C,{key:e.id,value:e.id.toString()},e.username)})))),w.default.createElement(x,{label:"\u5f00\u59cb\u65e5\u671f"},t("started_at",{initialValue:(0,M.default)()})(w.default.createElement(d.default,{format:"YYYY-MM-DD"}))),w.default.createElement(x,{label:"\u7ed3\u675f\u65e5\u671f"},t("ended_at",{initialValue:(0,M.default)()})(w.default.createElement(d.default,{format:"YYYY-MM-DD"}))),w.default.createElement(x,null,w.default.createElement(s.default,{type:"primary",icon:"search",onClick:function(){var t=e.props.form;t.validateFields(function(t,a){if(!t){var r=(0,o.default)({},a);e.handleSearch({page:1,per_page:e.state.per_page,user_id:r.user_id?r.user_id:"",started_at:a.started_at.format("YYYY-MM-DD"),ended_at:a.ended_at.format("YYYY-MM-DD")})}})}},"\u67e5\u8be2"),w.default.createElement(s.default,{style:{marginLeft:8},icon:"redo",onClick:this.handleFormReset},"\u91cd\u7f6e")))}},{key:"render",value:function(){var e=this.props.operation_logs,t=e.data,a=e.loading,r=e.meta,n=(this.props.form.getFieldDecorator,[{title:"\u64cd\u4f5c\u7528\u6237",dataIndex:"username",width:100,render:function(e,t){return(0,z.ellipsis2)(e,100)}},{title:"\u64cd\u4f5c\u65f6\u95f4",dataIndex:"created_at",width:150,render:function(e,t){return(0,z.ellipsis2)(e,150)}},{title:"\u64cd\u4f5c",dataIndex:"operation",width:150,render:function(e,t){return(0,z.ellipsis2)(e,150)}},{title:"\u8be6\u60c5",dataIndex:"detail",render:function(e,t){return(0,z.ellipsis2)(e,550)}}]);return console.log("this.state.tableY",this.state.tableY),w.default.createElement("div",{className:"table-box"},w.default.createElement("div",{className:"table-title"},"\u64cd\u4f5c\u65e5\u5fd7"),w.default.createElement("div",{className:"table-page"},w.default.createElement("div",null,w.default.createElement("div",null,this.renderSimpleForm()),w.default.createElement(l.default,{style:{color:"#fff"},className:"custom-small-table",loading:a,rowKey:"id",dataSource:t,columns:n,pagination:!1,size:"small",scroll:{x:!0,y:this.state.tableY}}),w.default.createElement(S.default,{searchCondition:{username:this.state.username,started_at:this.state.started_at,ended_at:this.state.ended_at},meta:r,handleSearch:this.handleSearch}))))}}]),a}(w.PureComponent),g=y))||g)||g),I=N;t.default=I}}]);