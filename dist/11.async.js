(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"+Tzf":function(e,t){function a(e,t){var a=-1,n=null==e?0:e.length;while(++a<n)if(!1===t(e[a],a,e))break;return e}e.exports=a},"1err":function(e,t,a){"use strict";var n=a("mZ4U"),l=a("fbTi");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("tIwr");var r=n(a("IX2G"));a("Jkyn");var o=n(a("DwzN"));a("s7Wz");var s=n(a("mLsM"));a("CuyC");var i=n(a("PdMq"));a("NRzj");var d=n(a("EDbO")),u=n(a("mK77")),c=n(a("43Yg")),f=n(a("/tCh")),p=n(a("Tfcp")),h=n(a("scpF")),m=n(a("O/V9")),g=n(a("8aBX"));a("DvNH");var v=n(a("SzGI"));a("pLlE");var C=n(a("qQZ1"));a("3nLr");var k=n(a("CWUu"));a("5KzM");var y,S,E,w,R=n(a("FCwu")),b=l(a("ZZRV")),_=(a("EaaV"),n(a("a/LZ")),a("LneV")),L=n(a("3xGV")),A=n(a("eKz+")),x=n(a("voBT"));function M(e){return function(){var t,a=(0,m.default)(e);if(F()){var n=(0,m.default)(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return(0,h.default)(this,t)}}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var N=R.default.Item,I=(k.default.Button,k.default.Group,C.default.Option,v.default.Search,v.default.TextArea,y=(0,_.connect)(function(e){var t=e.roles;e.loading;return{roles:t}}),S=R.default.create(),y(E=S((w=function(e){(0,g.default)(a,e);var t=M(a);function a(e){var n;return(0,c.default)(this,a),n=t.call(this,e),n.formLayout={labelCol:{span:7},wrapperCol:{span:13}},n.resize=function(){n.setState({tableY:document.querySelector(".table-page").offsetHeight-153})},n.handleSearch=function(e,t){console.log("handleSearch",e);var a=(0,p.default)(n),l=n.props.dispatch;l({type:"roles/fetch",payload:(0,u.default)({},e),callback:function(){console.log("handleSearch callback"),a.setState((0,u.default)({},e)),t&&t()}})},n.handleDelete=function(e){var t=(0,p.default)(n),a=n.props.dispatch;a({type:"roles/remove",payload:{id:e},callback:function(){d.default.success("\u5220\u9664\u89d2\u8272\u6210\u529f"),t.handleSearch({page:t.state.page,per_page:t.state.per_page})}})},n.handleFormReset=function(){var e=n.props.form;e.resetFields(),n.handleSearch({page:1,name:"",per_page:30})},n.findChildFunc=function(e){n.findChildGroup=e},n.handleAdd=function(){var e=n.AddRole.props.form.getFieldsValue();console.log("formValues",e);var t=n.findChildGroup();console.log(t);var a=(0,p.default)(n);n.props.dispatch({type:"roles/add",payload:(0,u.default)({},e,{permissions:t}),callback:function(){d.default.success("\u65b0\u5efa\u89d2\u8272\u6210\u529f"),a.setState({addModal:!1}),a.handleSearch({page:a.state.page,per_page:a.state.per_page})}})},n.handleEdit=function(){var e=n.EditRole.props.form.getFieldsValue();console.log("formValues",e);var t=n.findChildGroup();console.log(t);var a=(0,p.default)(n);n.props.dispatch({type:"roles/edit",payload:(0,u.default)({},e,{id:n.state.editRecord.id,permissions:t}),callback:function(){d.default.success("\u4fee\u6539\u89d2\u8272\u6210\u529f"),a.setState({editModal:!1}),a.handleSearch({page:a.state.page,per_page:a.state.per_page})}})},n.permissions=JSON.parse(sessionStorage.getItem("permissions")),n.state={showAddBtn:(0,x.default)(n.permissions,{name:"role_add_and_edit"}),showdelBtn:(0,x.default)(n.permissions,{name:"role_delete"}),visible:!1,done:!1,page:1,per_page:30,name:"",editRecord:{}},n}return(0,f.default)(a,[{key:"componentDidMount",value:function(){this.setState({tableY:document.querySelector(".table-page").offsetHeight-153});var e=this.props.dispatch;e({type:"roles/fetch",payload:{page:1,per_page:30,name:""}}),window.addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),window.removeEventListener("resize",this.resize)}},{key:"renderSimpleForm",value:function(){var e=this,t=this.props.form.getFieldDecorator;return b.default.createElement(R.default,{layout:"inline",className:"search-form"},b.default.createElement(N,{label:"\u89d2\u8272"},t("name")(b.default.createElement(v.default,{placeholder:"\u8bf7\u8f93\u5165"}))),b.default.createElement(N,null,b.default.createElement(i.default,{type:"primary",icon:"search",onClick:function(){var t=e.props.form;t.validateFields(function(t,a){if(!t){var n=(0,u.default)({},a);e.handleSearch({page:1,per_page:e.state.per_page,name:n.name?n.name:""})}})}},"\u67e5\u8be2"),b.default.createElement(i.default,{style:{marginLeft:8},icon:"redo",onClick:this.handleFormReset},"\u91cd\u7f6e"),this.state.showAddBtn&&b.default.createElement(i.default,{icon:"plus",style:{marginLeft:8},type:"primary",onClick:function(){e.setState({addModal:!0})}},"\u65b0\u5efa\u89d2\u8272")))}},{key:"render",value:function(){var e=this,t=this.props.roles,a=t.data,n=t.loading,l=t.meta,d=[{title:"\u89d2\u8272",width:150,dataIndex:"name"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at"},{title:"\u64cd\u4f5c",width:350,fixed:"right",render:function(t,a){return b.default.createElement(b.Fragment,null,e.state.showAddBtn&&(1===a.protection_level||3===a.protection_level)&&b.default.createElement(i.default,{style:{marginRight:"8px"},type:"primary",icon:"edit",size:"small",onClick:function(){e.setState({editRecord:a,editModal:!0})}},"\u7f16\u8f91"),e.state.showdelBtn&&2!==a.protection_level&&b.default.createElement(s.default,{title:"\u786e\u5b9a\u8981\u5220\u9664\u5417?",onConfirm:function(){return e.handleDelete(a.id)}},b.default.createElement(i.default,{style:{marginRight:"8px"},icon:"delete",size:"small",type:"danger"},"\u5220\u9664")))}}];return b.default.createElement("div",null,b.default.createElement("div",{className:"table-title"},"\u7528\u6237\u7ba1\u7406"),b.default.createElement("div",{className:"table-page"},b.default.createElement("div",null,b.default.createElement("div",null,this.renderSimpleForm()),b.default.createElement(o.default,{style:{color:"#fff"},className:"custom-small-table",loading:n,rowKey:"id",dataSource:a,columns:d,pagination:!1,size:"small",scroll:{x:!0,y:this.state.tableY}}),b.default.createElement(A.default,{searchCondition:{name:this.state.name},meta:l,handleSearch:this.handleSearch}))),b.default.createElement(r.default,{title:"\u65b0\u5efa\u89d2\u8272",visible:this.state.addModal,centered:!0,width:600,onCancel:function(){e.setState({addModal:!1})},onOk:this.handleAdd},b.default.createElement(L.default,{findChildFunc:this.findChildFunc,wrappedComponentRef:function(t){return e.AddRole=t}})),b.default.createElement(r.default,{title:"\u7f16\u8f91"+this.state.editRecord.name,destroyOnClose:!0,visible:this.state.editModal,centered:!0,width:600,onOk:this.handleEdit,onCancel:function(){e.setState({editModal:!1,editRecord:{}})}},b.default.createElement(L.default,{findChildFunc:this.findChildFunc,editRecord:this.state.editRecord,wrappedComponentRef:function(t){return e.EditRole=t}})))}}]),a}(b.PureComponent),E=w))||E)||E),z=I;t.default=z},"3xGV":function(e,t,a){"use strict";var n=a("mZ4U"),l=a("fbTi");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("DvNH");var r=n(a("SzGI")),o=n(a("zAuD")),s=n(a("3CjV"));a("NRzj");var i=n(a("EDbO")),d=n(a("mK77")),u=n(a("rXjv")),c=n(a("43Yg")),f=n(a("/tCh")),p=n(a("Tfcp")),h=n(a("scpF")),m=n(a("O/V9")),g=n(a("8aBX"));a("sOyT");var v=n(a("Ur7M"));a("5KzM");var C=n(a("FCwu"));a("aoHT");var k,y,S,E=n(a("1KHm")),w=l(a("ZZRV")),R=a("LneV"),b=a("DWJA"),_=n(a("t3Un")),L=n(a("iTfW")),A=n(a("aI28")),x=n(a("voBT"));function M(e){return function(){var t,a=(0,m.default)(e);if(F()){var n=(0,m.default)(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return(0,h.default)(this,t)}}function F(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}var N=E.default.Group,I=C.default.Item,z=(v.default.Content,k=(0,R.connect)(function(e){return{roles:e.roles}}),k((S=function(e){(0,g.default)(a,e);var t=M(a);function a(e){var n;return(0,c.default)(this,a),n=t.call(this,e),n.getGroup=function(){var e=(0,p.default)(n),t=[],a=[];console.log("that.state.group",e.state.group),(0,A.default)(e.state.group,function(a,n){t.push.apply(t,(0,u.default)(e.state[n+"CheckedList"]))});for(var l=function(n){(0,A.default)(e.state.group,function(e,l){var r=(0,x.default)(e,{name:t[n]});r&&a.push(r.id)})},r=0;r<t.length;r++)l(r);return a},n.handleSubmit=function(e){e.preventDefault();var t=(0,p.default)(n),a=n.props.match.params.id;n.props.form.validateFields({force:!0},function(e,l){if(!e){console.log(l);var r=n.isNew?"roles/add":"roles/edit",o=n.isNew?"\u6dfb\u52a0\u89d2\u8272\u6210\u529f":"\u4fee\u6539\u89d2\u8272\u6210\u529f",s=n.isNew?(0,d.default)({permissions:n.state.otherCheckedList.concat(n.state.userManageCheckedList)},l):(0,d.default)({id:a,permissions:n.state.otherCheckedList.concat(n.state.userManageCheckedList)},l);n.props.dispatch({type:r,payload:{data:s},callback:function(){i.default.success(o),t.props.dispatch(b.routerRedux.replace("/main/system_manage/account_manage/user_group_manage"))}})}})},n.handleSubmit2=function(e){e.preventDefault();var t=(0,p.default)(n),a=n.props.match.params.id;n.props.form.validateFields({force:!0},function(e,l){if(!e){console.log(l);var r=n.isNew?"roles/add":"roles/edit",o=n.isNew?"\u6dfb\u52a0\u89d2\u8272\u6210\u529f":"\u4fee\u6539\u89d2\u8272\u6210\u529f",s=[];(0,A.default)(t.state.group,function(e,a){s.push.apply(s,(0,u.default)(t.state[a+"CheckedList"]))});var c=sessionStorage.getItem("company_code"),f=n.isNew?(0,d.default)({permissions:s},l):(0,d.default)({id:a,permissions:s},l);n.props.dispatch({type:r,payload:{data:f},callback:function(){i.default.success(o),t.props.dispatch(b.routerRedux.replace("/".concat(c,"/main/system_manage/account_manage/user_group_manage")))}})}})},n.onChange=function(e){n.setState({userManageCheckedList:e,userIndeterminate:!!e.length&&e.length<n.state.userManage.length,checkAll:e.length===n.state.userManage.length})},n.onChange2=function(e,t){var a;console.log(e),console.log(t),n.setState((a={},(0,s.default)(a,t+"CheckedList",e),(0,s.default)(a,t+"Indeterminate",!!e.length&&e.length<n.state[t].length),(0,s.default)(a,t+"CheckAll",e.length===n.state[t].length),a))},n.onCheckAllChange2=function(e,t){var a;n.setState((a={},(0,s.default)(a,t+"CheckedList",e.target.checked?n.state[t].map(function(e,t){return e.value}):[]),(0,s.default)(a,t+"Indeterminate",!1),(0,s.default)(a,t+"CheckAll",e.target.checked),a))},n.onCheckAllChange=function(e){n.setState({userManageCheckedList:e.target.checked?n.state.userManage.map(function(e,t){return e.value}):[],userIndeterminate:!1,checkAll:e.target.checked})},n.onChangeOther=function(e){n.setState({otherCheckedList:e,otherIndeterminate:!!e.length&&e.length<n.state.other.length,otherCheckAll:e.length===n.state.other.length})},n.onCheckAllChangeOther=function(e){n.setState({otherCheckedList:e.target.checked?n.state.other.map(function(e,t){return e.value}):[],otherIndeterminate:!1,otherCheckAll:e.target.checked})},n.renderXheckGroup=function(e){var t=(0,p.default)(n),a={wrapperCol:{xs:{span:24},sm:{offset:5,span:15}}},l=[];return(0,A.default)(e,function(e,n){l.push(w.default.createElement(I,(0,o.default)({key:n},a),w.default.createElement("div",{className:"checkgroup-title"},w.default.createElement(E.default,{indeterminate:t.state[n+"Indeterminate"],onChange:function(e){return t.onCheckAllChange2(e,n)},checked:t.state[n+"CheckAll"]},n)),w.default.createElement(N,{options:t.state[n],value:t.state[n+"CheckedList"],onChange:function(e){return t.onChange2(e,n)}})))}),l},n.uuid=0,n.isNew=!n.props.editRecord,n.state={userManageCheckedList:[],villageCheckedList:[],otherCheckedList:[],other:[],userManage:[],village:[],userIndeterminate:!1,otherIndeterminate:!1,villageIndeterminate:!1,checkAll:!1,otherCheckAll:!1,villageCheckAll:!1,editRecord:{},"\u4f60\u597d\u8bc4":"234",group:{}},n}return(0,f.default)(a,[{key:"componentDidMount",value:function(){this.props.findChildFunc&&this.props.findChildFunc(this.getGroup);var e=this.props.dispatch,t=this;(0,_.default)("/permissions",{method:"GET",params:{}}).then(function(a){console.log("response",a);var n=(0,L.default)(a.data.data,"group");console.log("group",n),(0,A.default)(n,function(e,a){var n;t.setState((0,s.default)({},a,e.reduce(function(e,t){return t.label=t.display_name,t.value=t.name,e.push({label:t.display_name,value:t.name}),e},[]))),t.setState((n={},(0,s.default)(n,a+"CheckedList",[]),(0,s.default)(n,a+"Indeterminate",!1),(0,s.default)(n,a+"CheckAll",!1),n))}),t.setState({group:n},function(){if(this.isNew)console.log("\u65b0\u5efa\u89d2\u8272");else{console.log("\u4fee\u6539\u89d2\u8272");var a=this.props.editRecord.id;e({type:"roles/fetchOneusergroup",payload:{id:a},callback:function(){var e=t.props.roles.editRecord;console.log("editRecord",e);var a=(0,L.default)(e.permissions,"group");console.log("selectGroup",a),(0,A.default)(a,function(e,a){t.setState((0,s.default)({},a+"CheckedList",e.reduce(function(e,t){return e.push(t.name),e},[])),function(){var e;t.setState((e={},(0,s.default)(e,a+"Indeterminate",!!this.state[a+"CheckedList"].length&&this.state[a+"CheckedList"].length<this.state[a].length),(0,s.default)(e,a+"CheckAll",this.state[a+"CheckedList"].length===this.state[a].length),e))})})}})}})})}},{key:"render",value:function(){var e={labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:15}}},t=this.props.form.getFieldDecorator,a=this.props.roles.editRecord;return w.default.createElement("div",null,w.default.createElement(C.default,null,w.default.createElement(I,(0,o.default)({},e,{label:"\u89d2\u8272"}),t("name",{initialValue:this.props.editRecord?a.name:"",rules:[{required:!0}]})(w.default.createElement(r.default,null))),w.default.createElement("h3",{style:{textAlign:"center",margin:0}},"\u6743\u9650\u4fe1\u606f"),this.renderXheckGroup(this.state.group)))}}]),a}(w.Component),y=S))||y),D=C.default.create()(z),V=D;t.default=V},E9Wx:function(e,t,a){var n=a("jPiN");function l(e,t,a,l){return n(e,function(e,n,r){t(l,e,a(e),r)}),l}e.exports=l},NVmv:function(e,t,a){var n=a("f039");function l(e){return"function"==typeof e?e:n}e.exports=l},XBcf:function(e,t,a){var n=a("hACC"),l=a("E9Wx"),r=a("KNdF"),o=a("omV8");function s(e,t){return function(a,s){var i=o(a)?n:l,d=t?t():{};return i(a,e,r(s,2),d)}}e.exports=s},aI28:function(e,t,a){var n=a("+Tzf"),l=a("jPiN"),r=a("NVmv"),o=a("omV8");function s(e,t){var a=o(e)?n:l;return a(e,r(t))}e.exports=s},hACC:function(e,t){function a(e,t,a,n){var l=-1,r=null==e?0:e.length;while(++l<r){var o=e[l];t(n,o,a(o),e)}return n}e.exports=a},iTfW:function(e,t,a){var n=a("NH8m"),l=a("XBcf"),r=Object.prototype,o=r.hasOwnProperty,s=l(function(e,t,a){o.call(e,a)?e[a].push(t):n(e,a,[t])});e.exports=s}}]);